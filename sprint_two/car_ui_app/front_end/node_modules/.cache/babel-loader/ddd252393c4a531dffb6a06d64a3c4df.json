{"ast":null,"code":"/*\nCopyright (c) 2019 Daybrush\nname: css-styled\nlicense: MIT\nauthor: Daybrush\nrepository: git+https://github.com/daybrush/css-styled.git\nversion: 1.0.0\n*/\nimport { splitComma } from '@daybrush/utils';\n\nfunction hash(str) {\n  var hash = 5381,\n      i = str.length;\n\n  while (i) {\n    hash = hash * 33 ^ str.charCodeAt(--i);\n  }\n  /* JavaScript does bitwise operations (like XOR, above) on 32-bit signed\n   * integers. Since we want the results to be always positive, convert the\n   * signed int to an unsigned by doing an unsigned bitshift. */\n\n\n  return hash >>> 0;\n}\n\nvar stringHash = hash;\n\nfunction getHash(str) {\n  return stringHash(str).toString(36);\n}\n\nfunction getShadowRoot(parentElement) {\n  if (parentElement && parentElement.getRootNode) {\n    var rootNode = parentElement.getRootNode();\n\n    if (rootNode.nodeType === 11) {\n      return rootNode;\n    }\n  }\n\n  return;\n}\n\nfunction replaceStyle(className, css, options) {\n  if (options.original) {\n    return css;\n  }\n\n  return css.replace(/([^};{\\s}][^};{]*|^\\s*){/mg, function (_, selector) {\n    var trimmedSelector = selector.trim();\n    return (trimmedSelector ? splitComma(trimmedSelector) : [\"\"]).map(function (subSelector) {\n      var trimmedSubSelector = subSelector.trim();\n\n      if (trimmedSubSelector.indexOf(\"@\") === 0) {\n        return trimmedSubSelector;\n      } else if (trimmedSubSelector.indexOf(\":global\") > -1) {\n        return trimmedSubSelector.replace(/\\:global/g, \"\");\n      } else if (trimmedSubSelector.indexOf(\":host\") > -1) {\n        return \"\" + trimmedSubSelector.replace(/\\:host/g, \".\" + className);\n      } else if (trimmedSubSelector) {\n        return \".\" + className + \" \" + trimmedSubSelector;\n      } else {\n        return \".\" + className;\n      }\n    }).join(\", \") + \" {\";\n  });\n}\n\nfunction injectStyle(className, css, options, shadowRoot) {\n  var style = document.createElement(\"style\");\n  style.setAttribute(\"type\", \"text/css\");\n  style.setAttribute(\"data-styled-id\", className);\n\n  if (options.nonce) {\n    style.setAttribute(\"nonce\", options.nonce);\n  }\n\n  style.innerHTML = replaceStyle(className, css, options);\n  (shadowRoot || document.head || document.body).appendChild(style);\n  return style;\n}\n/**\n * Create an styled object that can be defined and inserted into the css.\n * @param - css styles\n */\n\n\nfunction styled(css) {\n  var injectClassName = \"rCS\" + getHash(css);\n  var injectCount = 0;\n  var injectElement;\n  return {\n    className: injectClassName,\n    inject: function (el, options) {\n      if (options === void 0) {\n        options = {};\n      }\n\n      var shadowRoot = getShadowRoot(el);\n      var firstMount = injectCount === 0;\n      var styleElement;\n\n      if (shadowRoot || firstMount) {\n        styleElement = injectStyle(injectClassName, css, options, shadowRoot);\n      }\n\n      if (firstMount) {\n        injectElement = styleElement;\n      }\n\n      if (!shadowRoot) {\n        ++injectCount;\n      }\n\n      return {\n        destroy: function () {\n          if (shadowRoot) {\n            el.removeChild(styleElement);\n            styleElement = null;\n          } else {\n            if (injectCount > 0) {\n              --injectCount;\n            }\n\n            if (injectCount === 0 && injectElement) {\n              injectElement.parentNode.removeChild(injectElement);\n              injectElement = null;\n            }\n          }\n        }\n      };\n    }\n  };\n}\n\nexport default styled;","map":{"version":3,"sources":["../src/utils.ts","../src/styled.ts"],"names":["getHash","str","stringHash","getShadowRoot","parentElement","rootNode","replaceStyle","className","css","options","trimmedSelector","selector","splitComma","trimmedSubSelector","subSelector","injectStyle","shadowRoot","style","document","injectClassName","injectCount","inject","firstMount","styleElement","injectElement","destroy","el"],"mappings":"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","sourcesContent":["import stringHash from \"string-hash\";\nimport { splitComma } from \"@daybrush/utils\";\nimport { InjectOptions } from \"./types\";\n\nexport function getHash(str: string) {\n    return stringHash(str).toString(36);\n}\nexport function getShadowRoot(parentElement: HTMLElement | SVGElement) {\n    if (parentElement && parentElement.getRootNode) {\n        const rootNode = parentElement.getRootNode();\n\n        if (rootNode.nodeType === 11) {\n            return rootNode;\n        }\n    }\n    return;\n}\nexport function replaceStyle(className: string, css: string, options: Partial<InjectOptions>) {\n    if (options.original) {\n        return css;\n    }\n    return css.replace(/([^};{\\s}][^};{]*|^\\s*){/mg, (_, selector) => {\n        const trimmedSelector = selector.trim();\n        return (trimmedSelector ? splitComma(trimmedSelector) : [\"\"]).map(subSelector => {\n            const trimmedSubSelector = subSelector.trim();\n            if (trimmedSubSelector.indexOf(\"@\") === 0) {\n                return trimmedSubSelector;\n            } else if (trimmedSubSelector.indexOf(\":global\") > -1) {\n                return trimmedSubSelector.replace(/\\:global/g, \"\");\n            } else if (trimmedSubSelector.indexOf(\":host\") > -1) {\n                return `${trimmedSubSelector.replace(/\\:host/g, `.${className}`)}`;\n            } else if (trimmedSubSelector) {\n                return `.${className} ${trimmedSubSelector}`;\n            } else {\n                return `.${className}`;\n            }\n        }).join(\", \") + \" {\";\n    });\n}\nexport function injectStyle(className: string, css: string, options: Partial<InjectOptions>, shadowRoot?: Node) {\n    const style = document.createElement(\"style\");\n\n    style.setAttribute(\"type\", \"text/css\");\n    style.setAttribute(\"data-styled-id\", className);\n\n    if (options.nonce) {\n        style.setAttribute(\"nonce\", options.nonce);\n    }\n    style.innerHTML = replaceStyle(className, css, options);\n\n    (shadowRoot || document.head || document.body).appendChild(style);\n    return style;\n}\n","import { getHash, injectStyle, getShadowRoot } from \"./utils\";\nimport { StyledInjector, InjectOptions } from \"./types\";\n\n/**\n * Create an styled object that can be defined and inserted into the css.\n * @param - css styles\n */\nfunction styled(css: string): StyledInjector {\n    const injectClassName = \"rCS\" + getHash(css);\n    let injectCount = 0;\n    let injectElement!: HTMLStyleElement;\n\n    return {\n        className: injectClassName,\n        inject(el: HTMLElement | SVGElement, options: Partial<InjectOptions> = {}) {\n            const shadowRoot = getShadowRoot(el);\n            const firstMount = injectCount === 0;\n            let styleElement: HTMLStyleElement;\n\n            if (shadowRoot || firstMount) {\n                styleElement = injectStyle(injectClassName, css, options, shadowRoot);\n            }\n            if (firstMount) {\n                injectElement = styleElement;\n            }\n            if (!shadowRoot) {\n                ++injectCount;\n            }\n            return {\n                destroy() {\n                    if (shadowRoot) {\n                        el.removeChild(styleElement);\n                        styleElement = null;\n                    } else {\n                        if (injectCount > 0) {\n                            --injectCount;\n                        }\n                        if (injectCount === 0 && injectElement) {\n                            injectElement.parentNode!.removeChild(injectElement);\n                            injectElement = null;\n                        }\n                    }\n                },\n            };\n        },\n    };\n}\n\nexport * from \"./types\";\nexport default styled;\n"]},"metadata":{},"sourceType":"module"}